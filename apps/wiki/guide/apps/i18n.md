# Multi-language support

## Setting up

1. Install the [Internationalization plugin for Vue](https://vue-i18n.intlify.dev/)

```bash
pnpm install vue-i18n
pnpm install @intlify/unplugin-vue-i18n
```

2. Add plugin to `./vite.config.ts`

```ts
import VueI18nPlugin from '@intlify/unplugin-vue-i18n/vite'
import path from 'node:path'

// ...
export default defineConfig({
  plugins: [
    // ... other plugins
    VueI18nPlugin({
      include: path.resolve(__dirname, './src/i18n/**')
    }),
  ],
})
```

3. Create some initial localization files.

::: details `@/i18n/en.json` - / EN file
{
    "home": "Home"
}
:::

::: details `@/i18n/fr.json` - / FR file
{
    "home": "Accueil"
}
:::

::: details `@/i18n/sandbox/en.json` - /sandbox EN file
{
    "sandbox.title": "Sandbox",
    "sandbox.description": "A sandbox for testing i18n features in a Vue application."
}
:::

::: details `@/i18n/sandbox/fr.json` - /sandbox FR file
{
    "sandbox.title": "Sandbox",
    "sandbox.description": "Un bac √† sable pour tester les fonctionnalit√©s i18n dans une application Vue."
}
:::

Translation File Structure:

```
src/i18n/
‚îú‚îÄ‚îÄ en.json          # Base English translations
‚îú‚îÄ‚îÄ fr.json          # Base French translations
‚îî‚îÄ‚îÄ PageA/           # Page-specific translations
    ‚îú‚îÄ‚îÄ en.json
    ‚îî‚îÄ‚îÄ fr.json
```

> [!NOTE]
> Translation structure can be only one level deep, so everything under `moduleA` has to be included in either base or module translation files.

4. Create i18n configuration `@/plugins/i18n.ts`

```ts
import { createI18n } from 'vue-i18n'
import messages from '@intlify/unplugin-vue-i18n/messages'

const i18n = createI18n({
  legacy: false,
  globalInjection: true,
  locale: 'en',
  fallbackLocale: 'en',
  fallbackWarn: false,
  messages,
})

export default i18n
```

5. Initialize i18n in main.ts

```ts
// ...
import i18n from './plugins/i18n'
// ...
app.use(i18n)
// ...
```

6. Test

Modify `@/App.vue`

```vue
<template>
  <router-link to="/">Home</router-link>
  |
  <router-link to="/about">About</router-link>
  |
  <router-link to="/sandbox">Sandbox</router-link>
  <br />
  <br />
  <v-radio-group inline v-model="locale" :label="t('choose.language')">
    <v-radio label="en" value="en"></v-radio>
    <v-radio label="fr" value="fr"></v-radio>
  </v-radio-group>
  <br />
  <br />
  <router-view />
</template>

<script setup lang="ts">
import { useI18n } from 'vue-i18n'
const { locale, t } = useI18n()
</script>

```

And `@/pages/sandbox/index.vue`

```vue{3,4,17,18}
<template>
  <v-card :style="cardBackground">
    <v-card-title><v-icon icon="$mdiHome" />{{ t('sandbox.title') }}</v-card-title>
    <v-card-text>{{ t('sandbox.description') }}</v-card-text>
    <v-card-actions>
      <v-btn @click="console.log('Primary!')" color="primary">Primary</v-btn>
      <v-btn @click="console.log('Secondary!')" color="secondary">Secondary</v-btn>
      <v-btn @click="theme.toggle()">Toggle theme</v-btn>
    </v-card-actions>
  </v-card>
</template>

<script setup lang="ts">
import { useTheme } from 'vuetify'
import { useCardBackground } from '@/composables/ui'

import { useI18n } from 'vue-i18n'
const { t } = useI18n()

const theme = useTheme()
const cardBackground = useCardBackground('#0000ff')
</script>
```

## Automation (Optional)

> [!Note]
> This feature is experimental

Translation automation will involve following steps:

1. Gathering of missing translations - using [i18n Missing Handler](https://vue-i18n.intlify.dev/api/composition.html#missinghandler)

2. Passing and caching missing translations to vite middleware handler.

3. Processing cached missed translations in timed intervals and adding to translation files.

4. Files can be then AI translated.

### Implementation

1. Create Vite Dev plugin for processing translations 

::: details `@/plugins/i18n-dev.ts`
<<< ../../../src/plugins/i18n-dev.ts 
:::

2. Add plugin to `./vite.config.ts` amd enable middleware

```ts
//
import { i18nDevPlugin}  from './src/plugins/i18n-dev'
//
  return {
    middlewareMode: true,
    plugins: [
//
      i18nDevPlugin(),
//
    ],
  }
//
```      

3. Add missing translated handler to `@/plugins/i18n.ts`

```ts{11-21}
import { createI18n } from 'vue-i18n'
import messages from '@intlify/unplugin-vue-i18n/messages'

const i18n = createI18n({
  legacy: false,
  globalInjection: true,
  locale: 'en',
  fallbackLocale: 'en',
  fallbackWarn: false,
  messages,
  missing: (locale: string, key: string) => {
    fetch('/i18n-add', {
      method: 'POST',
      body: JSON.stringify({
        data: { locale, key },
      }),
      headers: {
        'Content-Type': 'application/json',
      },
    })
  },
})

export default i18n
```

4. Test. 

Add in any `*.vue` file 

```vue
  <p>{{ t('welcome.message') }}</p>
```

And When navigating through pages in development mode, each 30 seconds there should be update of files in `./i18n` with missing translations.

```log
2:44:51 PM [vite] (client) page reload src/i18n/sandbox/en.json
üåê [i18n] Updated file: src\i18n\sandbox\en.json with 1 translations
2:44:51 PM [vite] (client) page reload src/i18n/sandbox/fr.json
üåê [i18n] Updated file: src\i18n\sandbox\fr.json with 1 translations
```
